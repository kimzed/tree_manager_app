{% extends "base.html" %}
{% load static %}

{% block title %}Create Parcel - Tree Manager{% endblock %}

{% block content %}
<div class="relative w-full" style="height: calc(100vh - 8rem);">
  <div id="parcels-map-container" class="w-full h-full rounded-lg"></div>

  <div class="absolute top-4 left-1/2 -translate-x-1/2 z-[1000] w-full max-w-md px-4">
    <form hx-post="{% url 'parcels:geocode' %}" hx-target="#parcels-geocode-result" class="join w-full">
      {% csrf_token %}
      <input type="text" name="address" placeholder="Search for an address..." class="input input-bordered join-item flex-1" />
      <button type="submit" class="btn btn-primary join-item">Search</button>
    </form>
    <div id="parcels-geocode-result" class="mt-2"></div>
  </div>

  <input type="hidden" id="parcels-lat" name="latitude" />
  <input type="hidden" id="parcels-lon" name="longitude" />

  <div id="parcels-area-display" class="absolute bottom-20 left-1/2 -translate-x-1/2 z-[1000] badge badge-lg badge-info hidden"></div>

  <div class="absolute bottom-4 left-1/2 -translate-x-1/2 z-[1000] flex gap-2">
    <form hx-post="{% url 'parcels:save' %}" hx-target="#parcels-save-result" hx-include="#parcels-lat, #parcels-lon" class="flex gap-2 items-center">
      {% csrf_token %}
      <input type="hidden" id="parcels-polygon" name="polygon" />
      <input type="hidden" id="parcels-area" name="area_m2" />
      <input type="text" name="name" id="parcels-name-input" placeholder="Parcel name (optional)" class="input input-bordered input-sm w-48 hidden" />
      <button type="submit" id="parcels-save-btn" class="btn btn-success hidden">Save Parcel</button>
    </form>
    <button type="button" id="parcels-clear-btn" class="btn btn-warning hidden">Clear &amp; Redraw</button>
  </div>

  <div id="parcels-save-result" class="absolute bottom-28 left-1/2 -translate-x-1/2 z-[1000] w-full max-w-md px-4"></div>
</div>

<script src="{% static 'js/map.js' %}"></script>
{% endblock %}
